<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Option Stop-Loss Loss Calculator — with Lot Size</title>
<style>
  :root { --bg:#0f1724; --card:#0b1220; --accent:#10b981; --muted:#9aa4b2; --danger:#ef4444; --glass: rgba(255,255,255,0.03); color-scheme: dark; }
  body{font-family:Inter,Segoe UI,system-ui,Arial;margin:0;background:linear-gradient(180deg,#041025 0%, #071225 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); padding:22px; border-radius:12px; width:820px; max-width:100%; box-shadow: 0 6px 30px rgba(2,6,23,0.7);}
  h1{margin:0 0 10px;font-size:18px;}
  p.lead{margin:0 0 18px;color:var(--muted);font-size:13px;}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px;}
  input[type="number"], input[type="text"], select {width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#e6eef6;font-size:14px;}
  .row {display:flex;gap:10px;}
  .full{grid-column:1/-1;}
  .btn {background:var(--accent);color:#042024;padding:10px 14px;border-radius:8px;border:none;font-weight:600;cursor:pointer;}
  .btn:active{transform:translateY(1px)}
  .result {margin-top:16px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03);}
  .big {font-size:18px;font-weight:700}
  .muted {color:var(--muted);font-size:13px}
  .small {font-size:13px;color:var(--muted)}
  .danger {color:var(--danger);font-weight:700}
  .info-line {display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
  .note {margin-top:10px;font-size:12px;color:var(--muted)}
  .toggle {display:flex;gap:8px}
  .radio-inline {display:flex;align-items:center;gap:8px}
  .footer {margin-top:12px;font-size:12px;color:var(--muted)}
  @media (max-width:880px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}.row{flex-direction:column}}
</style>
</head>
<body>
  <div class="card" role="main">
    <h1>Option Stop-Loss Loss Calculator — Delta · Gamma · Theta (with Lots)</h1>
    <p class="lead">Enter underlying, option premium, Greeks and lot information. Calculator estimates per-unit loss and total position loss if your underlying stop gets hit.</p>

    <div class="grid">
      <div>
        <label>Position type</label>
        <select id="posType">
          <option value="call">Long Call</option>
          <option value="put">Long Put</option>
        </select>
      </div>

      <div>
        <label>Current underlying price</label>
        <input id="currentPrice" type="number" step="0.01" value="22500" />
      </div>

      <div>
        <label>Stop-loss (underlying) — price</label>
        <input id="stopPrice" type="number" step="0.01" value="22480" />
      </div>

      <div>
        <label>Or: Stop-loss distance (points; optional)</label>
        <input id="stopPoints" type="number" step="0.01" placeholder="Leave empty to use stop price" />
      </div>

      <div>
        <label>Option entry premium (₹ per unit)</label>
        <input id="optPremium" type="number" step="0.01" value="15" />
      </div>

      <div>
        <label>Lot size (units per option contract)</label>
        <input id="lotSize" type="number" step="1" value="100" />
      </div>

      <div>
        <label>Number of lots (contracts)</label>
        <input id="numLots" type="number" step="1" value="1" />
      </div>

      <div>
        <label>Delta (e.g. 0.50)</label>
        <input id="delta" type="number" step="0.001" value="0.50" />
      </div>

      <div>
        <label>Gamma (e.g. 0.05)</label>
        <input id="gamma" type="number" step="0.001" value="0.05" />
      </div>

      <div>
        <label>Theta (points per day; e.g. 10)</label>
        <input id="theta" type="number" step="0.01" value="10" />
      </div>

      <div>
        <label>Expected holding time (hours)</label>
        <input id="holdHours" type="number" step="0.1" value="1" />
      </div>

      <div>
        <label>Advanced: Use absolute stop if checked (otherwise uses distance)</label>
        <div class="toggle"><label class="radio-inline"><input id="useStopPrice" type="checkbox" checked/> Use stop price</label></div>
      </div>

      <div class="full">
        <div style="display:flex;gap:10px;align-items:center">
          <button class="btn" id="calcBtn">Calculate loss</button>
          <button class="btn" id="resetBtn" style="background:#334155;color:#e6eef6">Reset example values</button>
        </div>
      </div>
    </div>

    <div id="result" class="result" aria-live="polite" hidden>
      <div class="info-line"><div class="muted">Underlying adverse move (points)</div><div id="movePoints" class="big"></div></div>
      <div class="info-line"><div class="muted">Average Delta used (approx, per unit)</div><div id="avgDelta" class="big"></div></div>
      <div class="info-line"><div class="muted">Premium loss from move (per unit)</div><div id="premLoss" class="big"></div></div>
      <div class="info-line"><div class="muted">Theta decay for holding time (per unit)</div><div id="thetaLoss" class="big"></div></div>
      <div class="info-line"><div class="muted">Estimated final premium (per unit)</div><div id="finalPremium" class="big"></div></div>
      <div class="info-line"><div class="muted">Loss per unit (₹)</div><div id="lossPerUnit" class="big danger"></div></div>

      <hr style="border:none;border-top:1px dashed rgba(255,255,255,0.03);margin:10px 0">

      <div class="info-line"><div class="muted">Lot size (units)</div><div id="showLot" class="big"></div></div>
      <div class="info-line"><div class="muted">Number of lots (contracts)</div><div id="showLots" class="big"></div></div>
      <div class="info-line"><div class="muted">Position value at entry (total)</div><div id="posValue" class="big"></div></div>
      <div class="info-line"><div class="muted">Total loss if SL hit (₹)</div><div id="totalLoss" class="big danger"></div></div>
      <div class="info-line"><div class="muted">% loss vs total position value</div><div id="percentLoss" class="big"></div></div>

      <p class="note">Notes: This is an approximation. Gamma is applied linearly to estimate avg delta during the adverse move. IV moves and actual orderflow can change real results. Use this for quick professional estimates.</p>
    </div>
  </div>

<script>
(function(){
  const $ = id => document.getElementById(id);

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
  function format(n){
    if (isNaN(n) || !isFinite(n)) return '-';
    return Number(n.toFixed(2)).toLocaleString();
  }

  function calculate(){
    const posType = $('posType').value; // 'call' or 'put'
    const currentPrice = parseFloat($('currentPrice').value);
    const stopPrice = parseFloat($('stopPrice').value);
    const stopPointsIn = $('stopPoints').value;
    const useStopPrice = $('useStopPrice').checked;
    const optPremium = parseFloat($('optPremium').value);
    const lotSize = parseInt($('lotSize').value) || 1;
    const numLots = parseInt($('numLots').value) || 1;
    let delta = parseFloat($('delta').value);
    let gamma = parseFloat($('gamma').value);
    const theta = parseFloat($('theta').value) || 0;
    const holdHours = parseFloat($('holdHours').value) || 0;

    if (isNaN(currentPrice) || isNaN(optPremium) || isNaN(delta) || isNaN(gamma)){
      alert('Please fill in numeric values for current price, option premium, delta and gamma.');
      return;
    }

    // Determine underlying adverse move (M)
    let M;
    if (stopPointsIn !== '' && !useStopPrice){
      M = Math.abs(parseFloat(stopPointsIn));
    } else {
      const sp = stopPrice;
      if (isNaN(sp)){
        alert('Please enter a valid stop price or provide stop points.');
        return;
      }
      if (posType === 'call') {
        M = Math.max(0, currentPrice - sp);
      } else {
        M = Math.max(0, sp - currentPrice);
      }
    }

    if (M <= 0){
      alert('Calculated adverse move is zero or negative. Make sure stop price represents an adverse move relative to current price OR enter stop points.');
      return;
    }

    // Approximate delta change due to gamma over the move:
    // finalDelta = delta - gamma * M (for long call adverse fall), clamp to [0,1]
    const finalDelta = clamp(delta - gamma * M, -1, 1); // allow negative deltas in edge cases (rare)
    const avgDelta = clamp((delta + finalDelta) / 2, -1, 1);

    // Premium loss from underlying move (per unit):
    const premLossFromMove = Math.abs(avgDelta * M); // points of premium expected to be lost (per unit)

    // Theta decay (convert theta per day to per hour):
    const thetaPerHour = theta / 24;
    const thetaLoss = thetaPerHour * holdHours;

    // Final premium per unit
    let finalPremium = optPremium - premLossFromMove - thetaLoss;
    if (finalPremium < 0) finalPremium = 0;

    // Loss per unit and total
    const lossPerUnit = optPremium - finalPremium; // per unit
    const unitsPerContract = lotSize; // e.g., 100
    const totalUnits = unitsPerContract * numLots;
    const positionValueEntry = optPremium * totalUnits; // total money invested at entry
    const totalLoss = lossPerUnit * totalUnits; // total loss if SL hit
    const percentLoss = positionValueEntry > 0 ? (totalLoss / positionValueEntry) * 100 : 0;

    // Populate results
    $('movePoints').textContent = format(M);
    $('avgDelta').textContent = format(avgDelta);
    $('premLoss').textContent = format(premLossFromMove);
    $('thetaLoss').textContent = format(thetaLoss);
    $('finalPremium').textContent = '₹ ' + format(finalPremium);
    $('lossPerUnit').textContent = '₹ ' + format(lossPerUnit);

    $('showLot').textContent = format(lotSize);
    $('showLots').textContent = format(numLots);
    $('posValue').textContent = '₹ ' + format(positionValueEntry);
    $('totalLoss').textContent = '₹ ' + format(totalLoss);
    $('percentLoss').textContent = format(percentLoss) + ' %';

    $('result').hidden = false;
  }

  $('calcBtn').addEventListener('click', calculate);

  $('resetBtn').addEventListener('click', function(){
    $('posType').value = 'call';
    $('currentPrice').value = 22500;
    $('stopPrice').value = 22480;
    $('stopPoints').value = '';
    $('optPremium').value = 15;
    $('lotSize').value = 100;
    $('numLots').value = 1;
    $('delta').value = 0.20;
    $('gamma').value = 0.02;
    $('theta').value = 2;
    $('holdHours').value = 1;
    $('useStopPrice').checked = true;
    $('result').hidden = true;
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      const active = document.activeElement;
      if (active && (active.tagName === 'INPUT' || active.tagName === 'SELECT')) {
        e.preventDefault();
        calculate();
      }
    }
  });
})();
</script>
